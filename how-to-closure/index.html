<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>how-to-closure.md - Grip</title>
  <link rel="icon" href="/__/grip/static/favicon.ico" />
  <link rel="stylesheet" href="/__/grip/asset/frameworks-d876e21057f406b37686f3dc7b9666f5957cda4847a48ec11e040df065624617.css" />
  <link rel="stylesheet" href="/__/grip/asset/github-f551691336dae8bd0ce4f4901c8cdd443fb0e1c4d2874c5d8091af332490a66b.css" />
  <link rel="stylesheet" href="/__/grip/asset/site-dd6d43570c14503704e8983a7dd8e62484a668da1ce4ce997929ae2f367584c0.css" />
  <link rel="stylesheet" href="/__/grip/static/octicons/octicons.css" />
  <style>
    /* Page tweaks */
    .preview-page {
      margin-top: 64px;
    }
    /* User-content tweaks */
    .timeline-comment-wrapper > .timeline-comment:after,
    .timeline-comment-wrapper > .timeline-comment:before {
      content: none;
    }
    /* User-content overrides */
    .discussion-timeline.wide {
      width: 920px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div id="preview-page" class="preview-page" data-autorefresh-url="/__/grip/refresh/">

    

      <div role="main" class="main-content">
        <div class="container new-discussion-timeline experiment-repo-nav">
          <div class="repository-content">
            <div id="readme" class="readme boxed-group clearfix announce instapaper_body md">
              
                <h3>
                  <span class="octicon octicon-book"></span>
                  how-to-closure.md
                </h3>
              
              <article class="markdown-body entry-content" itemprop="text" id="grip-content">
                <h1>
<a id="user-content-emulating-private-and-public-members-in-javascript-using-closure" class="anchor" href="#emulating-private-and-public-members-in-javascript-using-closure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Emulating Private and Public Members in JavaScript using Closure</h1>

<p><em>Greg Doolittle, 3/2/2017</em></p>

<p>In this guide, we will take a look at JavaScript's way of emulating a key feature of object-oriented programming: private and public members in classes.  We'll create getters and setters inside of a closure, and expose those methods.  We will also take a brief look at classes in ES6, and how we still need to use closure in order to emulate data privacy.</p>

<h2>
<a id="user-content-so-what-is-closure-in-javascript" class="anchor" href="#so-what-is-closure-in-javascript" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>So what is closure in JavaScript?</h2>

<p>Firstly, don't confuse the concept of closure with the programming language Clojure.  Closure provides a way to restrict access to data from the global scope.  This protects data as though it were a private member of a class.  When we say "make it private", we mean that we can keep it from being accessed or changed without going through the officially provided methods for doing so.  This quote from <a href="https://www.w3schools.com/js/js_function_closures.asp">w3schools.com</a> captures the idea of closure more clearly:</p>

<blockquote>
<p><em>A closure is a function having access to the parent scope, even after the parent function has closed.</em></p>
</blockquote>

<p>This sounds like a simple concept, but it has far-reaching implications.  We can leverage closures to create private and public members, a key feature of classes in object-oriented programming that is missing in JavaScript.</p>

<p>To dissect this a little, let's start by taking a look at a plain JavaScript object.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> book <span class="pl-k">=</span> {
    title<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Beyond Good and Evil<span class="pl-pds">"</span></span>,
    author<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Friedrich Nietzsche<span class="pl-pds">"</span></span>,
    year<span class="pl-k">:</span> <span class="pl-c1">1886</span>
};</pre></div>

<p>This object is in the global scope, and its properties can be referenced using either dot notation or bracket notation.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-c1">title</span>); <span class="pl-c"><span class="pl-c">//</span> "Beyond Good and Evil"</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-smi">author</span>); <span class="pl-c"><span class="pl-c">//</span> "Friedrich Nietzsche"</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(book[<span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>]) <span class="pl-c"><span class="pl-c">//</span> "Beyond Good and Evil"</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(book[<span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span>]); <span class="pl-c"><span class="pl-c">//</span> "Friedrich Nietzsche"</span></pre></div>

<p>That's convenient way to access the data about the book.  However, there is a potentially undesirable effect: if we pass the object around, we can access the properties directly off of the book variable.  However, if we have any concern about data security, there is a big problem here.  The problem is that as easily as we can access these properties, we can also change them.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">book</span>.<span class="pl-c1">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Crop Rotation<span class="pl-pds">"</span></span>;
<span class="pl-smi">book</span>.<span class="pl-smi">author</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Søren Kirkegaard<span class="pl-pds">"</span></span>;

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-c1">title</span>); <span class="pl-c"><span class="pl-c">//</span> "Crop Rotation"</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-smi">author</span>); <span class="pl-c"><span class="pl-c">//</span> "Søren Kirkegaard"</span>

book[<span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>The Second Sex<span class="pl-pds">"</span></span>;
<span class="pl-smi">book</span>.<span class="pl-smi">author</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Simone De Beauvoir<span class="pl-pds">"</span></span>;

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-c1">title</span>); <span class="pl-c"><span class="pl-c">//</span> "The Second Sex"</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-smi">author</span>); <span class="pl-c"><span class="pl-c">//</span> "Simone De Beauvoir"</span></pre></div>

<p>The properties have been reassigned, and we don't want that!  Let's look at how we can prevent this behavior.</p>

<p>This is where closures comes into play.  By wrapping our object in an immediately invoked function expression, we have hidden away the ability to access the properties of the object.  </p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> book <span class="pl-k">=</span> (<span class="pl-k">function</span>(){ 
    title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Beyond Good and Evil<span class="pl-pds">"</span></span>;
    author <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Friedrich Nietzsche<span class="pl-pds">"</span></span>;
    year <span class="pl-k">=</span> <span class="pl-c1">1886</span>;
})();

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-c1">title</span>); <span class="pl-c"><span class="pl-c">//</span> Error: book.title is undefined</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">book</span>.<span class="pl-smi">author</span>); <span class="pl-c"><span class="pl-c">//</span> Error: book.author is undefined</span></pre></div>

<p>You can no longer use dot notation to get the values in these properties.  </p>

<p>So we've made it so that people can't meddle with our data... but we've also made it entirely inaccessible to everyone else!  Let's fix that.</p>

<h2>
<a id="user-content-expose-methods-to-access-data" class="anchor" href="#expose-methods-to-access-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Expose methods to access data</h2>

<p>We still want to make the data reachable, and to do that, we will expose some new methods to provide this data.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> book <span class="pl-k">=</span> (<span class="pl-k">function</span>(){ 
    title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Beyond Good and Evil<span class="pl-pds">"</span></span>;
    author <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Friedrich Nietzsche<span class="pl-pds">"</span></span>;
    year <span class="pl-k">=</span> <span class="pl-c1">1886</span>;
    <span class="pl-k">function</span> <span class="pl-en">getTitle</span>() {
        <span class="pl-k">return</span> title;
    }
    <span class="pl-k">function</span> <span class="pl-en">getAuthor</span>() {
        <span class="pl-k">return</span> author;
    }
    <span class="pl-k">return</span> {
        getTitle<span class="pl-k">:</span>getTitle,
        getAuthor<span class="pl-k">:</span>getAuthor
    };
})();


<span class="pl-smi">book</span>.<span class="pl-en">getTitle</span>() <span class="pl-c"><span class="pl-c">//</span> "Beyond Good and Evil"</span>
<span class="pl-smi">book</span>.<span class="pl-en">getAuthor</span>() <span class="pl-c"><span class="pl-c">//</span> "Friedrich Nietzsche"</span></pre></div>

<p>We now have an object that holds our data, and doesn't provide any way of changing it.  </p>

<p>Let's say we want to make this work more like a class, we'll provide it in a factory format, which allows us to instantiate new Book elements with a constructor.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">Book</span>(<span class="pl-smi">title</span>, <span class="pl-smi">author</span>, <span class="pl-smi">year</span>) {
    <span class="pl-k">return</span> (<span class="pl-k">function</span>(){
        <span class="pl-c1">this</span>.<span class="pl-c1">title</span> <span class="pl-k">=</span> title;
        <span class="pl-c1">this</span>.<span class="pl-smi">author</span> <span class="pl-k">=</span> author;
        <span class="pl-c1">this</span>.<span class="pl-smi">year</span> <span class="pl-k">=</span> year;
        <span class="pl-k">function</span> <span class="pl-en">getTitle</span>() {
            <span class="pl-k">return</span> title;
        }
        <span class="pl-k">function</span> <span class="pl-en">getAuthor</span>() {
            <span class="pl-k">return</span> author;
        }
        <span class="pl-k">return</span> {
            getTitle<span class="pl-k">:</span>getTitle,
            getAuthor<span class="pl-k">:</span>getAuthor
        };

    });
}

<span class="pl-k">var</span> myBook <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Book</span>(<span class="pl-s"><span class="pl-pds">"</span>Tractatus Logico-Philosophicus<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Ludwig Wittgenstein<span class="pl-pds">"</span></span>, <span class="pl-c1">1921</span>)();

<span class="pl-smi">myBook</span>.<span class="pl-en">getTitle</span>(); <span class="pl-c"><span class="pl-c">//</span> "Tractatus Logico-Philosophicus"</span>
<span class="pl-smi">myBook</span>.<span class="pl-en">getAuthor</span>(); <span class="pl-c"><span class="pl-c">//</span> "Ludwig Wittgenstein"</span></pre></div>

<h2>
<a id="user-content-exposing-methods-to-update-data" class="anchor" href="#exposing-methods-to-update-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exposing methods to update data</h2>

<p>Let's say that we also want to provide a way to update our book object's data.  We can create setters as well:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> book <span class="pl-k">=</span> (<span class="pl-k">function</span>(){ 
    title <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Beyond Good and Evil<span class="pl-pds">"</span></span>;
    author <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Friedrich Nietzsche<span class="pl-pds">"</span></span>;
    year <span class="pl-k">=</span> <span class="pl-c1">1886</span>;
    <span class="pl-k">function</span> <span class="pl-en">getTitle</span>() {
        <span class="pl-k">return</span> title;
    }
    <span class="pl-k">function</span> <span class="pl-en">getAuthor</span>() {
        <span class="pl-k">return</span> author;
    }
    <span class="pl-k">function</span> <span class="pl-en">setTitle</span>(<span class="pl-smi">newTitle</span>) {
        title <span class="pl-k">=</span> newTitle;
    }
    <span class="pl-k">function</span> <span class="pl-en">setAuthor</span>(<span class="pl-smi">newAuthor</span>) {
        author <span class="pl-k">=</span> newAuthor;
    }
    <span class="pl-k">return</span> {
        getTitle<span class="pl-k">:</span> getTitle,
        getAuthor<span class="pl-k">:</span> getAuthor,
        setTitle<span class="pl-k">:</span> setTitle,
        setAuthor<span class="pl-k">:</span> setAuthor
    };
})();

<span class="pl-smi">book</span>.<span class="pl-en">getTitle</span>() <span class="pl-c"><span class="pl-c">//</span> "Beyond Good and Evil"</span>
<span class="pl-smi">book</span>.<span class="pl-en">setTitle</span>(<span class="pl-s"><span class="pl-pds">"</span>Principia Mathematica<span class="pl-pds">"</span></span>);
<span class="pl-smi">book</span>.<span class="pl-en">getTitle</span>(); <span class="pl-c"><span class="pl-c">//</span> "Principia Mathematica"</span></pre></div>

<p>Rolling everything together in our constructor-like factory function, we have:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">Book</span>(<span class="pl-smi">title</span>, <span class="pl-smi">author</span>, <span class="pl-smi">year</span>) {
    <span class="pl-k">return</span> (<span class="pl-k">function</span>(){
        <span class="pl-c1">this</span>.<span class="pl-smi">_title</span> <span class="pl-k">=</span> title;
        <span class="pl-c1">this</span>.<span class="pl-smi">_author</span> <span class="pl-k">=</span> author;
        <span class="pl-c1">this</span>.<span class="pl-smi">year</span> <span class="pl-k">=</span> year;
        <span class="pl-k">function</span> <span class="pl-en">getTitle</span>() {
            <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">_title</span>;
        }
        <span class="pl-k">function</span> <span class="pl-en">getAuthor</span>() {
            <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">_author</span>;
        }
        <span class="pl-k">function</span> <span class="pl-en">setTitle</span>(<span class="pl-smi">title</span>) {
            <span class="pl-c1">this</span>.<span class="pl-smi">_title</span> <span class="pl-k">=</span> title;
        }
        <span class="pl-k">function</span> <span class="pl-en">setAuthor</span>(<span class="pl-smi">author</span>) {
            <span class="pl-c1">this</span>.<span class="pl-smi">_author</span> <span class="pl-k">=</span> author;
        }
        <span class="pl-k">return</span> {
            getTitle<span class="pl-k">:</span>getTitle,
            getAuthor<span class="pl-k">:</span>getAuthor,
            setTitle<span class="pl-k">:</span>setTitle,
            setAuthor<span class="pl-k">:</span>setAuthor
        };

    });
}

<span class="pl-k">var</span> myBook <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Book</span>(<span class="pl-s"><span class="pl-pds">"</span>Tractatus Logico-Philosophicus<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Ludwig Wittgenstein<span class="pl-pds">"</span></span>, <span class="pl-c1">1921</span>)();

<span class="pl-smi">myBook</span>.<span class="pl-en">setTitle</span>(<span class="pl-s"><span class="pl-pds">"</span>Principia Mathematica<span class="pl-pds">"</span></span>);
<span class="pl-smi">myBook</span>.<span class="pl-en">setAuthor</span>(<span class="pl-s"><span class="pl-pds">"</span>Bertrand Russell<span class="pl-pds">"</span></span>); 

<span class="pl-smi">myBook</span>.<span class="pl-en">getTitle</span>(); <span class="pl-c"><span class="pl-c">//</span> "Principia Mathematica"</span>
<span class="pl-smi">myBook</span>.<span class="pl-en">getAuthor</span>(); <span class="pl-c"><span class="pl-c">//</span> "Bertrand Russell"</span></pre></div>

<p>Note: we update our private member properties to be prefixed with an underscore, because this is a standard convention in object-oriented programming.</p>

<h2>
<a id="user-content-es6-and-beyond" class="anchor" href="#es6-and-beyond" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ES6 and beyond</h2>

<p>In ECMAScript 6, we can use classes instead of factory functions.  ES6 also provides its own version of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get">getters</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/set">setters</a> on class members, but they don't provide data privacy, so we won't discuss those here.  Instead we're going to look at using ES6 classes with closure.  Doing so, we still need to use closure if we are going to provide any semblance of data security:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">class</span> <span class="pl-en">Book</span> {
    <span class="pl-en">constructor</span>(<span class="pl-smi">title</span>, <span class="pl-smi">author</span>, <span class="pl-smi">year</span>) {
        <span class="pl-k">let</span> _title <span class="pl-k">=</span> title;
        <span class="pl-k">let</span> _author <span class="pl-k">=</span> author;
        <span class="pl-k">let</span> _year <span class="pl-k">=</span> year;
        <span class="pl-c1">this</span>.<span class="pl-en">setTitle</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">title</span>) { 
            _title <span class="pl-k">=</span> title; 
        };
        <span class="pl-c1">this</span>.<span class="pl-en">getTitle</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() { 
            <span class="pl-k">return</span> _title; 
        };
        <span class="pl-c1">this</span>.<span class="pl-en">setAuthor</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">author</span>) { 
            _author <span class="pl-k">=</span> author; 
        };
        <span class="pl-c1">this</span>.<span class="pl-en">getAuthor</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() { 
            <span class="pl-k">return</span> _author; 
        };
        <span class="pl-c1">this</span>.<span class="pl-en">setYear</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">year</span>) { 
            _year <span class="pl-k">=</span> year; 
        };
        <span class="pl-c1">this</span>.<span class="pl-en">getYear</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() { 
            <span class="pl-k">return</span> _year; 
        };
    }
}

<span class="pl-k">let</span> myBook <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Book</span>(<span class="pl-s"><span class="pl-pds">"</span>Tractatus Logico-Philosophicus<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Ludwig Wittgenstein<span class="pl-pds">"</span></span>, <span class="pl-c1">1921</span>);
<span class="pl-smi">myBook</span>.<span class="pl-en">setTitle</span>(<span class="pl-s"><span class="pl-pds">"</span>Principia Mathematica<span class="pl-pds">"</span></span>);
<span class="pl-smi">myBook</span>.<span class="pl-en">setAuthor</span>(<span class="pl-s"><span class="pl-pds">"</span>Bertrand Russell<span class="pl-pds">"</span></span>); 

<span class="pl-smi">myBook</span>.<span class="pl-en">getTitle</span>(); <span class="pl-c"><span class="pl-c">//</span> "Principia Mathematica"</span>
<span class="pl-smi">myBook</span>.<span class="pl-en">getAuthor</span>(); <span class="pl-c"><span class="pl-c">//</span> "Bertrand Russell"</span></pre></div>

<p>In the future, the technical committee that drives JavaScript is looking towards creating a better and more succinct version of data privacy.  Here's a sneak peek at what they're envisioning for private data, in the future:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">class</span> <span class="pl-en">Dict</span> <span class="pl-k">extends</span> <span class="pl-e">null</span> {
  #data <span class="pl-k">=</span> something_secret;
  <span class="pl-en">add</span>(<span class="pl-smi">key</span>, <span class="pl-smi">value</span>) {
    <span class="pl-c1">this</span>[key] <span class="pl-k">=</span> value;
  }
  <span class="pl-en">get</span>(<span class="pl-smi">key</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">this</span>[key];
  }
}

(<span class="pl-k">new</span> <span class="pl-en">Dict</span>).<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">'</span>#data<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returns something_secret</span></pre></div>

<p>You can participate in the discussion on <a href="https://github.com/tc39/proposal-private-fields">Github</a>.  </p>

              </article>
            </div>
          </div>
        </div>
      </div>

    

  </div>
  <div>&nbsp;</div>
  </div><script>
    function showCanonicalImages() {
      var images = document.getElementsByTagName('img');
      if (!images) {
        return;
      }
      for (var index = 0; index < images.length; index++) {
        var image = images[index];
        if (image.getAttribute('data-canonical-src') && image.src !== image.getAttribute('data-canonical-src')) {
          image.src = image.getAttribute('data-canonical-src');
        }
      }
    }

    function scrollToHash() {
      if (location.hash && !document.querySelector(':target')) {
        var element = document.getElementById('user-content-' + location.hash.slice(1));
        if (element) {
           element.scrollIntoView();
        }
      }
    }

    function autorefreshContent(eventSourceUrl) {
      var initialTitle = document.title;
      var contentElement = document.getElementById('grip-content');
      var source = new EventSource(eventSourceUrl);
      var isRendering = false;

      source.onmessage = function(ev) {
        var msg = JSON.parse(ev.data);
        if (msg.updating) {
          isRendering = true;
          document.title = '(Rendering) ' + document.title;
        } else {
          isRendering = false;
          document.title = initialTitle;
          contentElement.innerHTML = msg.content;
          showCanonicalImages();
        }
      }

      source.onerror = function(e) {
        if (e.readyState === EventSource.CLOSED && isRendering) {
          isRendering = false;
          document.title = initialTitle;
        }
      }
    }

    window.onhashchange = function() {
      scrollToHash();
    }

    window.onload = function() {
      scrollToHash();
    }

    showCanonicalImages();

    var autorefreshUrl = document.getElementById('preview-page').getAttribute('data-autorefresh-url');
    if (autorefreshUrl) {
      autorefreshContent(autorefreshUrl);
    }
  </script>
</body>
</html>